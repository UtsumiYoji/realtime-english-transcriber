# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸: Realtime English Transcriber

## 1. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Realtime English Transcriber                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Queue   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Queue   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Audio    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ VAD + Whisper â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚Translatâ”‚ â”‚
â”‚  â”‚  Capture  â”‚  audio    â”‚    STT       â”‚  EN text  â”‚  ion   â”‚ â”‚
â”‚  â”‚ (Thread1) â”‚  chunks   â”‚  (Thread2)   â”‚           â”‚(Thread3â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â†‘                                                  â”‚     â”‚
â”‚       â”‚                                           EN+JA text   â”‚
â”‚       â”‚                                                  â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”‚
â”‚  â”‚                    Tkinter GUI (Main Thread)              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ [Audio Device â–¼]  [â–¶ Start] [â–  Stop]  [â˜‘ Translate] â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚ [12:30:01] EN: Hello, how are you today?            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ [12:30:01] JA: ã“ã‚“ã«ã¡ã¯ã€ä»Šæ—¥ã¯ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ [12:30:08] EN: I'm doing well, thank you.           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ [12:30:08] JA: å…ƒæ°—ã§ã™ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚         â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚ Status: â— Recording...              [ğŸ’¾ Save]       â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
realtime-english/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ requirements.md          # è¦ä»¶å®šç¾©æ›¸
â”‚   â”œâ”€â”€ architecture.md          # æœ¬æ›¸
â”‚   â””â”€â”€ setup.md                 # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                  # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ capture.py           # éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£ (WASAPI Loopback)
â”‚   â”œâ”€â”€ stt/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ vad.py               # Silero VAD ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â””â”€â”€ transcriber.py       # faster-whisper ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ translation/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ translator.py        # DeepL API ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ gui/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ app.py               # Tkinter ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config.py            # è¨­å®šç®¡ç† (config.yaml)
â”‚       â””â”€â”€ file_export.py       # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
â”œâ”€â”€ config.yaml                  # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ requirements.txt             # Python ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ pyproject.toml               # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â””â”€â”€ README.md
```

## 3. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°è¨­è¨ˆ

### 3.1 Audio Capture (`src/audio/capture.py`)

**è²¬å‹™:** Windows WASAPI ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£

```python
class AudioCapture:
    """
    WASAPI ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãŸéŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£ã€‚
    sounddevice (PortAudio) ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã€
    PyAudioWPatch ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨ã€‚
    """
    def get_devices() -> list[AudioDevice]
        # åˆ©ç”¨å¯èƒ½ãªã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã‚’è¿”ã™
        # ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯å¯¾å¿œãƒ‡ãƒã‚¤ã‚¹ã«ãƒ•ãƒ©ã‚°ã‚’ä»˜ä¸

    def start(device_id: int, callback: Callable) -> None
        # æŒ‡å®šãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’é–‹å§‹
        # callback ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒãƒ£ãƒ³ã‚¯ã‚’ queue ã«æŠ•å…¥

    def stop() -> None
        # éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚’åœæ­¢
```

**éŸ³å£°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³:**
```
WASAPI Loopback Output (é€šå¸¸ 48kHz, Stereo, Float32)
    â†“ ã‚¹ãƒ†ãƒ¬ã‚ªâ†’ãƒ¢ãƒãƒ©ãƒ«å¤‰æ› (å·¦å³ãƒãƒ£ãƒ³ãƒãƒ«å¹³å‡)
    â†“ scipy.signal.resample_poly ã§ãƒ€ã‚¦ãƒ³ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    â†“
16kHz, Mono, Float32 (Whisper / Silero VAD å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ)
```

### 3.2 VAD (`src/stt/vad.py`)

**è²¬å‹™:** éŸ³å£°åŒºé–“ã®æ¤œå‡ºã¨ç™ºè©±å˜ä½ã®ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°

```python
class VoiceActivityDetector:
    """
    Silero VAD ã‚’ä½¿ç”¨ã—ãŸéŸ³å£°åŒºé–“æ¤œå‡ºã€‚
    éŸ³å£°ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å—ã‘å–ã‚Šã€ç™ºè©±é–‹å§‹/çµ‚äº†ã‚’æ¤œå‡ºã—ã¦
    ç™ºè©±å˜ä½ã®éŸ³å£°ãƒãƒ£ãƒ³ã‚¯ã‚’å‡ºåŠ›ã™ã‚‹ã€‚
    """
    def __init__(self, threshold: float = 0.5,
                 min_speech_ms: int = 250,
                 max_speech_s: float = 30.0)

    def process_chunk(self, audio_chunk: np.ndarray) -> list[np.ndarray]
        # éŸ³å£°ãƒãƒ£ãƒ³ã‚¯ã‚’å‡¦ç†ã—ã€å®Œäº†ã—ãŸç™ºè©±ã®éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
        # - éŸ³å£°é–‹å§‹æ¤œå‡º â†’ ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°é–‹å§‹
        # - éŸ³å£°çµ‚äº†æ¤œå‡º â†’ ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã•ã‚ŒãŸéŸ³å£°ã‚’è¿”ã™
        # - 30ç§’è¶…ã®é€£ç¶šç™ºè©± â†’ å¼·åˆ¶ãƒ•ãƒ©ãƒƒã‚·ãƒ¥

    def reset(self) -> None
        # VAD ã®å†…éƒ¨çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
```

**VAD å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
```
Audio Chunk (16kHz, ~100ms)
    â†“
512 ã‚µãƒ³ãƒ—ãƒ« (32ms) ãƒ•ãƒ¬ãƒ¼ãƒ ã«åˆ†å‰²
    â†“
Silero VAD ã§å„ãƒ•ãƒ¬ãƒ¼ãƒ ã® speech probability ã‚’ç®—å‡º
    â†“
â”Œâ”€ probability > threshold â†’ éŸ³å£°åŒºé–“
â”‚   â†’ ãƒãƒƒãƒ•ã‚¡ã«è“„ç©
â”‚   â†’ 30ç§’è¶…ãªã‚‰å¼·åˆ¶ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
â””â”€ probability < threshold ãŒä¸€å®šæ™‚é–“ç¶šã â†’ ç™ºè©±çµ‚äº†
    â†’ ãƒãƒƒãƒ•ã‚¡ã®å†…å®¹ã‚’è¿”å´
    â†’ ãƒãƒƒãƒ•ã‚¡ã‚’ã‚¯ãƒªã‚¢
```

### 3.3 STT Transcriber (`src/stt/transcriber.py`)

**è²¬å‹™:** éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã¸ã®å¤‰æ›

```python
class Transcriber:
    """
    faster-whisper ã‚’ä½¿ç”¨ã—ãŸéŸ³å£°èªè­˜ã€‚
    VAD ã‹ã‚‰å—ã‘å–ã£ãŸç™ºè©±å˜ä½ã®éŸ³å£°ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹ã€‚
    """
    def __init__(self, model_size: str = "base.en",
                 compute_type: str = "int8")
        # ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ (åˆå›ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒç™ºç”Ÿ)

    def transcribe(self, audio: np.ndarray) -> str
        # éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›
        # è¿”ã‚Šå€¤: èªè­˜ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
```

### 3.4 Translation (`src/translation/translator.py`)

**è²¬å‹™:** è‹±èªãƒ†ã‚­ã‚¹ãƒˆã®æ—¥æœ¬èªç¿»è¨³

```python
class Translator:
    """
    DeepL Free API ã‚’ä½¿ç”¨ã—ãŸ ENâ†’JA ç¿»è¨³ã€‚
    ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã¨ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’å†…è”µã€‚
    """
    def __init__(self, api_key: str)

    def translate(self, text: str) -> str | None
        # è‹±èªãƒ†ã‚­ã‚¹ãƒˆã‚’æ—¥æœ¬èªã«ç¿»è¨³
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚ã¯ API ã‚’å‘¼ã°ãªã„
        # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ None ã‚’è¿”ã™

    @property
    def is_available(self) -> bool
        # API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
```

### 3.5 GUI (`src/gui/app.py`)

**è²¬å‹™:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æä¾›ã¨ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```python
class TranscriberApp:
    """
    Tkinter ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€‚
    å„ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç®¡ç†ã—ã€çµæœã‚’è¡¨ç¤ºã™ã‚‹ã€‚
    """
    def __init__(self, config: AppConfig)

    def run(self) -> None
        # Tkinter ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹

    # --- å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ ---
    def _start_capture(self) -> None
    def _stop_capture(self) -> None
    def _poll_results(self) -> None      # after(100ms) ã§å®šæœŸå®Ÿè¡Œ
    def _save_transcript(self) -> None
    def _update_display(self, entry: TranscriptEntry) -> None
```

**GUI ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Audio Device: [Combobox â–¼]  [â–¶ Start] [â–  Stop]â”‚  â† ä¸Šéƒ¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼
â”‚ [â˜‘ Translation]  [â˜‘ Auto-save]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚  â† ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢
â”‚ [12:30:01] EN: Hello, welcome to the meeting  â”‚     (ScrolledText)
â”‚ [12:30:01] JA: ã“ã‚“ã«ã¡ã¯ã€ä¼šè­°ã¸ã‚ˆã†ã“ã        â”‚
â”‚                                               â”‚
â”‚ [12:30:08] EN: Let me share my screen         â”‚
â”‚ [12:30:08] JA: ç”»é¢ã‚’å…±æœ‰ã•ã›ã¦ãã ã•ã„          â”‚
â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— Recording | Model: base.en      [ğŸ’¾ Save]  â”‚  â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 Config (`src/utils/config.py`)

**è²¬å‹™:** è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã

```python
@dataclass
class AppConfig:
    deepl_api_key: str = ""
    whisper_model: str = "base.en"
    compute_type: str = "int8"
    translation_enabled: bool = True
    auto_save_path: str = ""
    default_device: str = ""
    vad_threshold: float = 0.5

    @classmethod
    def load(cls, path: str = "config.yaml") -> "AppConfig"

    def save(self, path: str = "config.yaml") -> None
```

### 3.7 File Export (`src/utils/file_export.py`)

**è²¬å‹™:** ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜

```python
class FileExporter:
    """
    ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ã€‚
    æ‰‹å‹•ä¿å­˜ã¨è‡ªå‹•ä¿å­˜ï¼ˆè¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ï¼‰ã®ä¸¡æ–¹ã«å¯¾å¿œã€‚
    """
    def save_transcript(self, entries: list, filepath: str) -> None
        # å…¨ã‚¨ãƒ³ãƒˆãƒªã‚’ä¸€æ‹¬ä¿å­˜

    def start_auto_save(self, filepath: str) -> None
        # è‡ªå‹•ä¿å­˜ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆè¿½è¨˜ãƒ¢ãƒ¼ãƒ‰ï¼‰

    def append_entry(self, entry: TranscriptEntry) -> None
        # è‡ªå‹•ä¿å­˜å…ˆã«1ã‚¨ãƒ³ãƒˆãƒªè¿½è¨˜

    def stop_auto_save(self) -> None
        # è‡ªå‹•ä¿å­˜ãƒ¢ãƒ¼ãƒ‰çµ‚äº†
```

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 4.1 ãƒ¡ã‚¤ãƒ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
1. AudioCapture (sounddevice callback, å†…éƒ¨ã‚¹ãƒ¬ãƒƒãƒ‰)
   - WASAPI Loopback ã§éŸ³å£°ãƒãƒ£ãƒ³ã‚¯ã‚’å–å¾—
   - 16kHz mono ã«å¤‰æ›
   - audio_queue ã«æŠ•å…¥

2. STT Worker Thread
   - audio_queue ã‹ã‚‰ãƒãƒ£ãƒ³ã‚¯ã‚’å–å¾—
   - VoiceActivityDetector.process_chunk() ã§ VAD å‡¦ç†
   - ç™ºè©±å®Œäº†æ™‚ â†’ Transcriber.transcribe() ã§æ–‡å­—èµ·ã“ã—
   - çµæœ (EN text + timestamp) ã‚’ text_queue ã«æŠ•å…¥

3. Translation Worker Thread
   - text_queue ã‹ã‚‰ EN text ã‚’å–å¾—
   - translation_enabled ãªã‚‰ Translator.translate() ã§ç¿»è¨³
   - çµæœ (EN + JA text + timestamp) ã‚’ display_queue ã«æŠ•å…¥

4. GUI Main Thread (100ms é–“éš”ãƒãƒ¼ãƒªãƒ³ã‚°)
   - display_queue ã‹ã‚‰çµæœã‚’å–å¾—
   - ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã«è¿½è¨˜
   - è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
   - è‡ªå‹•ä¿å­˜æœ‰åŠ¹ãªã‚‰ FileExporter.append_entry()
```

### 4.2 ãƒ‡ãƒ¼ã‚¿å‹

```python
@dataclass
class TranscriptEntry:
    timestamp: datetime
    english_text: str
    japanese_text: str | None = None  # ç¿»è¨³ OFF æ™‚ã¯ None
```

## 5. ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«

| ã‚¹ãƒ¬ãƒƒãƒ‰ | å½¹å‰² | ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ç®‡æ‰€ | çµ‚äº†æ¡ä»¶ |
|---|---|---|---|
| Main Thread | Tkinter GUI ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ— | ãªã—ï¼ˆ`after()` ã§éåŒæœŸãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰ | ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–‰ã˜ |
| Audio Thread | sounddevice ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ | PortAudio å†…éƒ¨ã§ç®¡ç† | `AudioCapture.stop()` |
| STT Thread | VAD + Whisper æ¨è«– | `audio_queue.get()` (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ã) | `stop_event.set()` |
| Translation Thread | DeepL API å‘¼ã³å‡ºã— | `text_queue.get()` (ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ã) | `stop_event.set()` |

**ã‚¹ãƒ¬ãƒƒãƒ‰é–“é€šä¿¡:**
- `audio_queue: Queue[np.ndarray]` â€” Audio â†’ STT
- `text_queue: Queue[TranscriptEntry]` â€” STT â†’ Translation
- `display_queue: Queue[TranscriptEntry]` â€” Translation â†’ GUI
- `stop_event: threading.Event` â€” å…¨ã‚¹ãƒ¬ãƒƒãƒ‰åœæ­¢ã‚·ã‚°ãƒŠãƒ«

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å‡¦ |
|---|---|
| ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹æ¥ç¶š/åˆ‡æ–­ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€‚å†æ¥ç¶šå¯èƒ½ |
| Whisper ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰å¤±æ•— | èµ·å‹•æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã€‚ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºå¤‰æ›´ã‚’ä¿ƒã™ |
| DeepL API ã‚­ãƒ¼æœªè¨­å®š | ç¿»è¨³ OFF ã§å‹•ä½œç¶™ç¶šã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã«è­¦å‘Š |
| DeepL API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã§æœ€å¤§ 3 å›ãƒªãƒˆãƒ©ã‚¤ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ | ç¿»è¨³ã‚’ã‚¹ã‚­ãƒƒãƒ—ã— EN text ã®ã¿è¡¨ç¤ºã€‚ãƒªãƒˆãƒ©ã‚¤ |
| ãƒ¡ãƒ¢ãƒªä¸è¶³ | éŸ³å£°ãƒãƒƒãƒ•ã‚¡ã‚’åˆ¶é™ (æœ€å¤§ 30 ç§’)ã€‚å¤ã„ã‚¨ãƒ³ãƒˆãƒªã¯è¡¨ç¤ºã®ã¿ä¿æŒ |

---

## æ”¹è¨‚å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|---|---|---|
| 2026-02-17 | 1.0 | åˆç‰ˆä½œæˆ |
